name: Update Dual AI Rules
on:
  schedule:
    - cron: '0 21 * * *'
  workflow_dispatch: 

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Process AI Rules
        run: |
          mkdir -p rules
          
          # --- 1. 国外 AI (改名为 AI_Proxy.list) ---
          curl -sL https://raw.githubusercontent.com/Blackmatrix7/ios_rule_script/master/rule/Surge/OpenAI/OpenAI.list > rules/tmp_g.txt
          curl -sL https://raw.githubusercontent.com/Blackmatrix7/ios_rule_script/master/rule/Surge/Claude/Claude.list >> rules/tmp_g.txt
          # (去重并改名)
          grep -v '^#' rules/tmp_g.txt | grep -v '^\s*$' | sort -u > rules/AI_Proxy.list

          # --- 2. 国内 AI (改名为 AI_Direct.list) ---
          echo "DOMAIN-SUFFIX,deepseek.com" > rules/tmp_i.txt
          echo "DOMAIN-SUFFIX,moonshot.cn" >> rules/tmp_i.txt
          # (去重并改名)
          grep -v '^#' rules/tmp_i.txt | grep -v '^\s*$' | sort -u > rules/AI_Direct.list


      - name: Push Changes
        run: |
          git add rules/*.list  # 这会添加 rules 文件夹下所有 .list 后缀的文件
          git commit -m "Update Rules" || exit 0
          git push

